.. 
   Input file: fe/ips/mchan/doc/CL_DMA_reference.md

Register map
^^^^^^^^^^^^


Overview
""""""""


Refer to :ref:`GAP9 address map<REF_MEMORY_MAP_DETAIL>` for the base address to be used.

.. table:: 
    :align: center
    :widths: 40 12 12 90

    +-----------------------------+------+-----+----------------------------------+
    |            Name             |Offset|Width|           Description            |
    +=============================+======+=====+==================================+
    |:ref:`CMD<cl_dma__CMD>`      |     0|   32|Cluster DMA configuration register|
    +-----------------------------+------+-----+----------------------------------+
    |:ref:`STATUS<cl_dma__STATUS>`|     4|   32|Cluster DMA status register       |
    +-----------------------------+------+-----+----------------------------------+

.. _cl_dma__CMD:

CMD
"""

Cluster DMA configuration register

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+-------+------+------------------------------------------+
    |Bit #|R/W| Name  |Reset |               Description                |
    +=====+===+=======+======+==========================================+
    |31:0 |R/W|COMMAND|0x0000|DMA command -- Format is command-dependent|
    +-----+---+-------+------+------------------------------------------+

.. _cl_dma__STATUS:

STATUS
""""""

Cluster DMA status register

.. table:: 
    :align: center
    :widths: 13 12 45 24 85

    +-----+---+---------+------+------------------------------------------------------------------------------------------------------+
    |Bit #|R/W|  Name   |Reset |                                             Description                                              |
    +=====+===+=========+======+======================================================================================================+
    |15:0 |R/W|TID_TR   |0x0000|When read, bit=1 means that transfer with TID i is active. Write 1 to cancel/free transfer with TID i.|
    +-----+---+---------+------+------------------------------------------------------------------------------------------------------+
    |31:16|R  |TID_ALLOC|0x0000|Bit 16+i is read as 1 if when transfer allocator with TID i is reserved, else it is free.             |
    +-----+---+---------+------+------------------------------------------------------------------------------------------------------+

DMA commands encoding
^^^^^^^^^^^^^^^^^^^^^

.. table:: 
    :align: center
    :widths: 45 15 15 80

    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |                     Command name                     |Width|Command code|                                            Description                                            |
    +======================================================+=====+============+===================================================================================================+
    |:ref:`GET_TID<DMA commands encoding__GET_TID>`        |   32|N/A         |(Triggered by reading CMD register before configuring a transfer) Get transfer identifier.         |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`NEW_TRANS<DMA commands encoding__NEW_TRANS>`    |   32|N/A         |Start to configure a new transfer.                                                                 |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`TCDM_ADDR<DMA commands encoding__TCDM_ADDR>`    |   32|N/A         |Configure TCDM address of the transfer.                                                            |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`L2_ADDR<DMA commands encoding__L2_ADDR>`        |   32|N/A         |Configure L2 address of the transfer.                                                              |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`L2_COUNT<DMA commands encoding__L2_COUNT>`      |   32|N/A         |For a 2D transfer on L2 side, configure the length of the linear chucks of data for the transfer.  |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`L2_STRIDE<DMA commands encoding__L2_STRIDE>`    |   32|N/A         |For a 2D transfer on L2 side, configure the stride of the transfer.                                |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`TCDM_COUNT<DMA commands encoding__TCDM_COUNT>`  |   32|N/A         |For a 2D transfer on TCDM side, configure the length of the linear chucks of data for the transfer.|
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+
    |:ref:`TCDM_STRIDE<DMA commands encoding__TCDM_STRIDE>`|   32|N/A         |For a 2D transfer on TCDM side, configure the stride of the transfer.                              |
    +------------------------------------------------------+-----+------------+---------------------------------------------------------------------------------------------------+

.. _DMA commands encoding__GET_TID:

GET_TID
"""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+----+---------------------------------+
    |Bit #|Name|           Description           |
    +=====+====+=================================+
    |3:0  |TID |Value of the transfer identifier.|
    +-----+----+---------------------------------+

.. _DMA commands encoding__NEW_TRANS:

NEW_TRANS
"""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |Bit #| Name  |                                                                    Description                                                                     |
    +=====+=======+====================================================================================================================================================+
    |16:0 |LEN    |Transfer length in bytes.                                                                                                                           |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |17   |TYPE   |Transfer direction: b0: TCDM to L2; b1: L2 to TCDM.                                                                                                 |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |18   |INC    |Set to 1 to configure an incremental transfer.                                                                                                      |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |19   |L2_2D  |Transfer type on L2 side: b0: linear; b1: 2D transfer.                                                                                              |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |20   |ELE    |Set to 1 to enable event generation for the transfer.                                                                                               |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |21   |ILE    |Set to 1 to enable interrupt generation for the transfer.                                                                                           |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |22   |BLE    |Set to 1 to broadcast event and interrupts to all cluster cores. If 0, events and interrupts are only sent to the core which initiated the transfer.|
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+
    |23   |TCDM_2D|Transfer type on TCDM side: b0: linear; b1: 2D transfer.                                                                                            |
    +-----+-------+----------------------------------------------------------------------------------------------------------------------------------------------------+

.. _DMA commands encoding__TCDM_ADDR:

TCDM_ADDR
"""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+----+-----------------------------------+
    |Bit #|Name|            Description            |
    +=====+====+===================================+
    |31:0 |ADDR|TCDM base address for the transfer.|
    +-----+----+-----------------------------------+

.. _DMA commands encoding__L2_ADDR:

L2_ADDR
"""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+----+---------------------------------+
    |Bit #|Name|           Description           |
    +=====+====+=================================+
    |31:0 |ADDR|L2 base address for the transfer.|
    +-----+----+---------------------------------+

.. _DMA commands encoding__L2_COUNT:

L2_COUNT
""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+------+-----------------------------------------+
    |Bit #| Name |               Description               |
    +=====+======+=========================================+
    |31:0 |2D_CNT|Length of a linear part of a 2D transfer.|
    +-----+------+-----------------------------------------+

.. _DMA commands encoding__L2_STRIDE:

L2_STRIDE
"""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+---------+------------------------------------------------------------------------------------+
    |Bit #|  Name   |                                    Description                                     |
    +=====+=========+====================================================================================+
    |31:0 |2D_STRIDE|Length of a stride of a 2D transfer (i.e. from a linear chunck of data to the next).|
    +-----+---------+------------------------------------------------------------------------------------+

.. _DMA commands encoding__TCDM_COUNT:

TCDM_COUNT
""""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+------+-----------------------------------------+
    |Bit #| Name |               Description               |
    +=====+======+=========================================+
    |31:0 |2D_CNT|Length of a linear part of a 2D transfer.|
    +-----+------+-----------------------------------------+

.. _DMA commands encoding__TCDM_STRIDE:

TCDM_STRIDE
"""""""""""

.. table:: 
    :align: center
    :widths: 15 45 90

    +-----+---------+------------------------------------------------------------------------------------+
    |Bit #|  Name   |                                    Description                                     |
    +=====+=========+====================================================================================+
    |31:0 |2D_STRIDE|Length of a stride of a 2D transfer (i.e. from a linear chunck of data to the next).|
    +-----+---------+------------------------------------------------------------------------------------+
